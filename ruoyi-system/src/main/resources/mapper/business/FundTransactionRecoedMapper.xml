<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.business.mapper.FundTransactionRecordMapper">

    <insert id="insert" >
        insert into m_fund_transaction_record
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userId != null">user_id,</if>
            <if test="type != null">type,</if>
            <if test="amount != null">amount,</if>
            <if test="transactionTime != null">transaction_time,</if>
            <if test="balanceBefore != null">balance_before,</if>
            <if test="balanceAfter != null">balance_after,</if>
            <if test="remark != null and remark != ''">remark,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="userId != null">#{userId},</if>
            <if test="type != null">#{type},</if>
            <if test="amount != null">#{amount},</if>
            <if test="transactionTime != null">#{transactionTime},</if>
            <if test="balanceBefore != null">#{balanceBefore},</if>
            <if test="balanceAfter != null">#{balanceAfter},</if>
            <if test="remark != null and remark != ''">#{remark},</if>
        </trim>
    </insert>

    <!-- 原有SQL：查用户所有交易记录 -->
    <select id="listByUserId" resultType="com.ruoyi.click.domain.FundTransactionRecord">
        SELECT * FROM m_fund_transaction_record
        WHERE user_id = #{userId}
        ORDER BY transaction_time DESC  <!-- 按交易时间倒序（最新的在前） -->
    </select>

    <!-- 新增SQL：查用户指定类型的交易记录 -->
    <select id="listByUserIdAndType" resultType="com.ruoyi.click.domain.FundTransactionRecord">
        SELECT * FROM m_fund_transaction_record
        WHERE user_id = #{userId}
        AND type = #{type}  <!-- 筛选类型：1=转入，2=转出 -->
        ORDER BY transaction_time DESC
    </select>

</mapper>